name: Append beseo events to public JSONL log

on:
  push:
    paths:
      - 'beseo/**'
      - 'beseo'
    # ignore the log so commits that update the log won't re-trigger
    paths-ignore:
      - 'logs/beseo.jsonl'

permissions:
  contents: write

jobs:
  append-log:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository (full history)
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          persist-credentials: true

      - name: Make script executable
        run: chmod +x .github/scripts/log-beseo-public.sh

      - name: Configure git user
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "41898282+github-actions[bot]@users.noreply.github.com"

      - name: Run logger
        env:
          GITHUB_BEFORE: ${{ github.event.before }}
          GITHUB_AFTER: ${{ github.sha }}
          GITHUB_ACTOR: ${{ github.actor }}
          GITHUB_REPOSITORY: ${{ github.repository }}
          GITHUB_REF: ${{ github.ref }}
        run: .github/scripts/log-beseo-public.sh
